<!DOCTYPE html>
<html>
   <head>
      <meta charset="ISO-8859-1">
      <title>Bharatiya Temple Library</title>
      <!-- Latest compiled and minified CSS -->
      <link rel="stylesheet"
         href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css">
      <link href='css/rotating-card.css' rel='stylesheet' />
      <link rel="stylesheet"
         href="https://fonts.googleapis.com/css?family=Roboto:400,100,300,500">
      <!-- Optional theme -->
      <link rel="stylesheet"
         href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap-theme.min.css">
      <link href="http://netdna.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet" />
      <script
         src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
      <!-- Latest compiled and minified JavaScript -->
      <script
         src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
      <script type="text/javascript">
         var selectedUser;
         
         
         function initUserTable() {
         	var table = document.getElementById("usersTable");
         	document.getElementById("usersTableBody").innerHTML = "";
         }
         
         function multiplyNode(node, deep) {
         	$.ajax({url: "eventsProxy", success: function(result){
         		var resultObj = jQuery.parseJSON(result);
         		for (var i = 4, copy; i >=0; i--) {
         			
         	        copy = node.cloneNode(deep);
         	        copy.querySelector(".name").innerHTML=resultObj[i].event_name;
         	        copy.querySelector(".profession").innerHTML=resultObj[i].event_date;
         	        copy.querySelector(".img").src="http://www.troy-temple.org/" + resultObj[i].event_img;
         		    copy.querySelector(".motto").innerHTML=resultObj[i].event_venue + " <br> " + resultObj[i].event_date;
         	        copy.querySelector(".email").innerHTML="Contact emails:<br>" + resultObj[i].event_recipient_emails;
         		    node.parentNode.insertBefore(copy, node);
         	    }
         		node.remove();
         		
             }});
         }
         
         	function validatePhoneNumber(inputtxt) {
         	var phoneno = /^\d{10}$/;
         	if (inputtxt.match(phoneno)) {
         		return true;
         	} else {
         		bootbox.alert("Please enter 10 digit valid Phone Number!");
         		return false;
         	}
         }
         
         function signup() {
         
         	if (validatePhoneNumber($('#form-phoneNumber').val())) {
         		var name = $('#form-firstName').val() + " "
         				+ $('#form-lastName').val()
         		$.ajax({
         					url : "welcome?method=insert&phoneNumber="
         							+ $('#form-phoneNumber').val() + "&firstName="
         							+ $('#form-firstName').val() + "&lastName="
         							+ $('#form-lastName').val() + "&member="
         							+ $('#form-member').val(),
         					success : function(result) {
         						$("#messageDisplay")
         								.html(
         										"Thank you <b>"
         												+ name
         												+ "</b> for visiting us today. There are interesting upcoming Temple events as shown below. Please check them out.");
         						$("#signup")[0].reset();
         						$('#modal-login').modal('hide');
         					}
         				});
         	}
         
         	return false;
         }
         
         function insertLog() {
         
         	$.ajax({
         				url : "welcome?method=insertLog&phoneNumber="
         						+ selectedUser.phoneNumber + "&firstName="
         						+ selectedUser.firstName + "&lastName="
         						+ selectedUser.lastName,
         				success : function(result) {
         					initUserTable();
         					$("#messageDisplay")
         							.html(
         									"Thank you for visiting us today. There are interesting upcoming Temple events as shown below. Please check them out.");
         				}
         			});
         	return false;
         }
         function getList() {
         	var phone = $("#list-phoneNumber").val();
         	$.ajax({
         				url : "welcome?method=list&phoneNumber=" + phone,
         				success : function(result) {
         					console.log(result);
         					if (result == "Logged user") {
         						initUserTable();
         						$("#messageDisplay").html("Thank you for visiting us today. There are interesting upcoming Temple events as shown below. Please check them out.");
         					} else {
         
         						if (result.length == 0) {
         							var phoneNumber = document.getElementById("list-phoneNumber").value;
         							document.getElementById("form-phoneNumber").value=phoneNumber;
         							$('#modal-login').modal('show');
         							return;
         						}
         
         						var table = document.getElementById("usersTable");
         						document.getElementById("usersTableBody").innerHTML = "";
         						for (var i = 0; i < result.length; i++) {
         							var row = table.insertRow(0);
         							var firstNameCell = row.insertCell(0);
         							var lastNameCell = row.insertCell(1);
         							var selection = row.insertCell(2);
         							firstNameCell.innerHTML = result[i].firstName;
         							lastNameCell.innerHTML = result[i].lastName;
         							selectedUser = result[i];
         							var htmlString = "<button style='color:black' onclick='insertLog()'>Sign me in</button>";
         							selection.innerHTML = htmlString;
         						}
         					}
         				}
         			});
         
         	return false;
         }
      </script>
      <style>
         a, a:active, a:visited {
         color: white;
         }
         a:hover {
         color: yellow;
         background-color: #def;
         }
         .card .user {
         border-radius:inherit;
         }
      </style>
   </head>
   <body>
      <!-- Top content -->
      <div class="top-content">
      <font color="white">
         <div class="row">
            <div class="col-sm-8 col-sm-offset-2 text">
               <h1>
                  <strong>Bharatiya</strong> Community Library
               </h1>
               <div class="description">
                  <p>
                     Welcome to the Bharatiya Community Library. If you are not
                     already a member, <strong><a
                        class="btn btn-link-1 launch-modal" href="#"
                        data-modal-id="modal-login">sign up here</a></strong>
                  </p>
               </div>
            </div>
         </div>
         <div class="row">
         <div class="col-sm-6 col-sm-offset-3 form-box">
            <div class="form-top">
               <div class="form-top-left">
                  <h3>Log your visit to our library</h3>
                  <p>Please enter your phone number:</p>
               </div>
            </div>
            <div class="form-bottom">
               <!-- This is the login with phone number form -->
               <form role="form" onsubmit="return getList()" class="login-form">
                  <div class="form-group">
                     <label class="sr-only" for="form-phoneNumber">Phone
                     Number</label> <input type="text" name="list-phoneNumber"
                        id="list-phoneNumber" placeholder="Phone Number..."
                        class="form-username form-control" id="form-username">
                  </div>
                  <button type="submit" style="color: black">Sign in!</button>
               </form>
               <div id="list">
                  <table id="usersTable" class="table table-bordered">
                     <tbody id="usersTableBody"></tbody>
                  </table>
               </div>
               <div id="messageDisplay"></div>
            </div>
      </font>
      <!-- MODAL -->
      <div class="modal fade" id="modal-login" tabindex="-1" role="dialog"
         aria-labelledby="modal-login-label" aria-hidden="true">
      <div class="modal-dialog">
      <div class="modal-content">
      <div class="modal-header">
      <button type="button" class="close" data-dismiss="modal">
      <span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
      </button>
      <h3 class="modal-title" id="modal-login-label">Welcome to our
      library</h3>
      <p>Enter your name and phone number below:</p>
      </div>
      <div class="modal-body">
      <form role="form" onsubmit="return signup()" id="signup"
         class="login-form">
      <div class="form-group">
      <input type="text" name="firstName" placeholder="First Name..."
         class="form-username form-control" id="form-firstName">
      </div>
      <div class="form-group">
      <input type="text" name="lastName" placeholder="Last Name..."
         class="form-username form-control" id="form-lastName">
      </div>
      <div class="form-group">
      <input type="text" name="phoneNumber"
         placeholder="Phone Number..."
         class="form-username form-control" id="form-phoneNumber">
      </div>
      <div class="form-group">
      <select class="selectpicker" id="form-member">
      <option value="false">Non Member</option>
      <option value="true">Temple Member</option>
      </select>
      </div>
      <input type="hidden" name="method" value="insert">
      <button type="submit" class="btn">Sign up!</button>
      </form>
      </div>
      </div>
      </div>
      </div>
      </div>
      <!-- flipping cards end -->
      <div class="container">
      <div class="row">
      <div class="col-sm-10 col-sm-offset-1" id="parent">
         <div class="col-md-4 col-sm-6" id="flippingcard">
            <div class="card-container">
               <div class="card">
                  <div class="front">
                     <div class="content">
                        <div class="main">
                           <h5 class="name">Mobi Boot Camp Corp.</h5>
                           <p class="profession">Where you learn, build and publish mobile apps!</p>
                        </div>
                        <div class="user">
                           <img class="img" src=""/>
                        </div>
                     </div>
                  </div>
                  <!-- end front panel -->
                  <div class="back">
                     <div class="header">
                        <h5 class="motto">"To be or not to be, this is my awesome motto!"</h5>
                     </div>
                     <div class="content">
                        <div class="main">
                           <div class="email">Web design, Adobe Photoshop, HTML5, CSS3, Corel and many others...</div>
                        </div>
                     </div>
                  </div>
                  <!-- end back panel -->
               </div>
               <!-- end card -->
            </div>
            <!-- end card-container -->
         </div>
         <!-- end col sm 3 -->
         <div class="space-200"></div>
      </div>
      <!-- flipping cards end -->
      <!-- Javascript -->
      <script src="js/jquery.backstretch.min.js"></script>
      <script src="js/scripts.js"></script>
      <script src="js/bootbox.min.js"></script>
      <script src="js/popScripts.js"></script>
      <script>
         multiplyNode(document.querySelector('#flippingcard'), true);
         
      </script>
   </body>
</html>